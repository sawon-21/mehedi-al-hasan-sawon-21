<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Manage Comments</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getDatabase, ref, set, get, onValue, push, remove } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCGKbu0R4inHCCNo6_uIiD30O3xYt-NLqU",
            authDomain: "writer-845e1.firebaseapp.com",
            databaseURL: "https://writer-845e1-default-rtdb.firebaseio.com",
            projectId: "writer-845e1",
            storageBucket: "writer-845e1.appspot.com",
            messagingSenderId: "852313784855",
            appId: "1:852313784855:web:79c1eeb33b2120d4bf5252",
            measurementId: "G-8YNXC75H5Q"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        document.addEventListener("DOMContentLoaded", () => {
            const commentsDiv = document.getElementById("comments");

            // Fetch and display comments in real-time
            onValue(ref(db, "profile/comments"), (snapshot) => {
                commentsDiv.innerHTML = ""; // Clear previous comments
                snapshot.forEach((childSnapshot) => {
                    let commentData = childSnapshot.val();
                    let commentId = childSnapshot.key;

                    let commentElement = document.createElement("div");
                    commentElement.classList.add("comment-box");
                    commentElement.innerHTML = `
                        <strong>${commentData.name}</strong> 
                        <span class="comment-date">${commentData.date}</span>
                        <p>${commentData.comment}</p>
                        <button class="delete-btn" data-id="${commentId}">Delete</button>
                        <button class="reply-btn" data-id="${commentId}">Reply</button>
                        <div class="reply-section" id="replies-${commentId}"></div>
                    `;

                    commentsDiv.prepend(commentElement);

                    // Load Replies
                    onValue(ref(db, `profile/comments/${commentId}/replies`), (replySnapshot) => {
                        const repliesDiv = document.getElementById(`replies-${commentId}`);
                        repliesDiv.innerHTML = ""; // Clear old replies
                        replySnapshot.forEach((replyChild) => {
                            let replyData = replyChild.val();
                            let replyElement = document.createElement("div");
                            replyElement.classList.add("reply-box");
                            replyElement.innerHTML = `
                                <strong>Admin:</strong> <span class="comment-date">${replyData.date}</span>
                                <p>${replyData.reply}</p>
                            `;
                            repliesDiv.appendChild(replyElement);
                        });
                    });

                    // Delete Comment
                    commentElement.querySelector(".delete-btn").addEventListener("click", (e) => {
                        let commentId = e.target.getAttribute("data-id");
                        if (confirm("Are you sure you want to delete this comment?")) {
                            remove(ref(db, `profile/comments/${commentId}`));
                        }
                    });

                    // Reply to Comment
                    commentElement.querySelector(".reply-btn").addEventListener("click", (e) => {
                        let commentId = e.target.getAttribute("data-id");
                        let replyText = prompt("Enter your reply:");
                        if (replyText) {
                            let replyData = {
                                reply: replyText,
                                date: new Date().toLocaleString(),
                            };
                            push(ref(db, `profile/comments/${commentId}/replies`), replyData);
                        }
                    });
                });
            });
        });
    </script>
</head>
<body>

<div class="admin-container">
    <h2>Admin Panel - Manage Comments</h2>
    <div id="comments"></div>
</div>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f8f9fa;
        padding: 20px;
    }
    .admin-container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .comment-box {
        background: #f4f4f4;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 15px;
        border-left: 4px solid #007BFF;
    }
    .comment-box strong {
        color: #007BFF;
    }
    .comment-date {
        font-size: 12px;
        color: gray;
        margin-left: 10px;
    }
    .reply-box {
        background: #e9ecef;
        padding: 8px;
        border-radius: 5px;
        margin-left: 20px;
        margin-top: 5px;
        border-left: 4px solid #28a745;
    }
    .delete-btn, .reply-btn {
        background: #dc3545;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        margin-top: 5px;
        margin-right: 5px;
        border-radius: 5px;
        font-size: 14px;
    }
    .reply-btn {
        background: #007BFF;
    }
    .delete-btn:hover {
        background: #c82333;
    }
    .reply-btn:hover {
        background: #0056b3;
    }
</style>

</body>
</html>