<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Manage Comments</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getDatabase, ref, set, get, onValue, push, remove } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCGKbu0R4inHCCNo6_uIiD30O3xYt-NLqU",
            authDomain: "writer-845e1.firebaseapp.com",
            databaseURL: "https://writer-845e1-default-rtdb.firebaseio.com",
            projectId: "writer-845e1",
            storageBucket: "writer-845e1.appspot.com",
            messagingSenderId: "852313784855",
            appId: "1:852313784855:web:79c1eeb33b2120d4bf5252",
            measurementId: "G-8YNXC75H5Q"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        document.addEventListener("DOMContentLoaded", () => {
            const commentsDiv = document.getElementById("comments");
            const marqueeElement = document.getElementById("marqueeText");
            const marqueeInput = document.getElementById("marqueeInput");
            const marqueeUpdateBtn = document.getElementById("updateMarquee");

            // Fetch and display comments in real-time
            onValue(ref(db, "profile/comments"), (snapshot) => {
                commentsDiv.innerHTML = ""; // Clear previous comments
                snapshot.forEach((childSnapshot) => {
                    let commentData = childSnapshot.val();
                    let commentId = childSnapshot.key;

                    let commentElement = document.createElement("div");
                    commentElement.classList.add("comment-box");
                    commentElement.innerHTML = `
                        <strong>${commentData.name}</strong> 
                        <span class="comment-date">${commentData.date}</span>
                        <p>${commentData.comment}</p>
                        <button class="delete-btn" data-id="${commentId}">Delete</button>
                        <button class="reply-btn" data-id="${commentId}">Reply</button>
                        <div class="reply-section" id="replies-${commentId}"></div>
                    `;

                    commentsDiv.prepend(commentElement);

                    // Load Replies
                    onValue(ref(db, `profile/comments/${commentId}/replies`), (replySnapshot) => {
                        const repliesDiv = document.getElementById(`replies-${commentId}`);
                        repliesDiv.innerHTML = ""; // Clear old replies
                        replySnapshot.forEach((replyChild) => {
                            let replyData = replyChild.val();
                            let replyElement = document.createElement("div");
                            replyElement.classList.add("reply-box");
                            replyElement.innerHTML = `
                                <strong>Admin:</strong> <span class="comment-date">${replyData.date}</span>
                                <p>${replyData.reply}</p>
                            `;
                            repliesDiv.appendChild(replyElement);
                        });
                    });

                    // Delete Comment
                    commentElement.querySelector(".delete-btn").addEventListener("click", (e) => {
                        let commentId = e.target.getAttribute("data-id");
                        if (confirm("Are you sure you want to delete this comment?")) {
                            remove(ref(db, `profile/comments/${commentId}`));
                        }
                    });

                    // Reply to Comment
                    commentElement.querySelector(".reply-btn").addEventListener("click", (e) => {
                        let commentId = e.target.getAttribute("data-id");
                        let replyText = prompt("Enter your reply:");
                        if (replyText) {
                            let replyData = {
                                reply: replyText,
                                date: new Date().toLocaleString(),
                            };
                            push(ref(db, `profile/comments/${commentId}/replies`), replyData);
                        }
                    });
                });
            });

            // Load and listen for changes in marquee text
            const marqueeRef = ref(db, "marqueeText");
            onValue(marqueeRef, (snapshot) => {
                const newText = snapshot.val();
                marqueeElement.textContent = newText || "Add HeadLine";
            });

            // Update Marquee Text
            marqueeUpdateBtn.addEventListener("click", () => {
                const newText = marqueeInput.value.trim();
                if (newText) {
                    set(marqueeRef, newText)
                        .then(() => alert("HeadLine updated successfully!"))
                        .catch((error) => alert("Error updating marquee text: " + error.message));
                } else {
                    alert("Please enter new HeadLine!");
                }
            });
        });
        document.getElementById("marqueeInput").addEventListener("input", function () {
    document.getElementById("previewMarquee").textContent = this.value || "Your text will appear here...";
});
    </script>
</head>
<body>

<div class="admin-container">
    <h1 style="color:brown">Admin Panel - Manage Comments</h1>

<div class="marquee-container">
    <h3>Update HeadLine</h3>
    
    <!-- Live Preview Box -->
    <div class="preview-box">
        <marquee id="previewMarquee">Your text will appear here...</marquee>
    </div>
    
    <input type="text" id="marqueeInput" placeholder="Enter new HeadLine">
    <button id="updateMarquee">Update</button>
</div>

    <!-- Display Marquee -->
    <p style="background-color:yellow"><i><b>Latest :</b></i></p>
    <div class="marquee-display"> <hr>
        <marquee id="marqueeText">Loading...</marquee>
    </div>
<hr> <br>
    <h3>Manage Comments</h3>
    <div id="comments"></div>
</div>

<style>
/* Global Styles */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');



body {
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    color: #fff;
    padding: 20px;
    
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: black;
}

/* Admin Panel Container */

/* Section Titles */
 h3 {
    color: #ffcc;
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
    margin-bottom: 15px;
}

/* Marquee Section */
.marquee-container {
    background: rgba(255, 255, 255, 0.15);
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    text-align: center;
}

/* Live Preview Box */
.preview-box {
    background: rgba(255, 255, 255, 0.2);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    transition: 0.3s;
}

.preview-box:hover {
    transform: scale(1.02);
}

marquee {
    font-size: 18px;
    font-weight: bold;
    color: #ffcc00;
}

/* Input Field */
#marqueeInput {
    width: 80%;
    padding: 10px;
    border: none;
    outline: none;
    font-size: 16px;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.3);
    color: #111;
    transition: 0.3s;
    margin-bottom: 10px;
}

#marqueeInput:focus {
    background: rgba(255, 255, 255, 0.5);
}

/* Button */
#updateMarquee {
    background: linear-gradient(135deg, #28a745, #218838);
    color: white;
    border: none;
    padding: 10px 15px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 8px;
    transition: 0.3s;
}

#updateMarquee:hover {
    background: linear-gradient(135deg, #218838, #28a745);
    transform: scale(1.05);
}
/* Buttons */
button {
    background: linear-gradient(135deg, #ff416c, #ff4b2b);
    color: white;
    border: none;
    padding: 10px 15px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 8px;
    transition: 0.3s;
}

button:hover {
    background: linear-gradient(135deg, #ff4b2b, #ff416c);
    transform: scale(1.05);
}

/* Comments Section */
.comment-box {
    background: rgba(230, 255, 255, 0.2);
    padding: 5px;
    border-radius: 10px;
    margin-bottom: 15px;
    border-left: 5px solid #ffcc00;
    transition: 0.3s;
    display: flex;
    font-weight: bold;
    flex-direction: column;
    align-items: flex-start;
}

.comment-box:hover {
    transform: scale(1.02);
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
}
.comment-box p{
  font-size: 25px;
  color: #fff;
}
.comment-box strong {
    color: #ffcc00;
}

/* Comment Date */
.comment-date {
    font-size: 8px;
    color: rgba(255, 255, 255, 0.7);
    margin-left: 10px;
}

/* Replies */
.reply-box {
    background: #8888;
    padding: 4px;
    border-radius: 8px;
    margin-left: 20px;
    margin-top: 10px;
    border-left: 4px solid #28a745;
}

/* Buttons for Delete & Reply */
.delete-btn, .reply-btn {
    padding: 8px 12px;
    font-size: 14px;
    border-radius: 8px;
    transition: 0.3s;
    margin-top: 5px;
}

.delete-btn {
    background: linear-gradient(135deg, #ff416c, #ff4b2b);
}

.delete-btn:hover {
    background: linear-gradient(135deg, #ff4b2b, #ff416c);
}

.reply-btn {
    background: linear-gradient(135deg, #007bff, #0056b3);
}

.reply-btn:hover {
    background: linear-gradient(135deg, #0056b3, #007bff);
}

/* Responsive Design */

</style>

</body>
</html>